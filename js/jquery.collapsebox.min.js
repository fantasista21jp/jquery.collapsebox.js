(function(e){e.fn.collapsebox=function(a){function q(){var d={};g=b.container.height();h=b.handle.outerHeight({margin:true});if(g==h){g=b.container.css({height:"",overflow:""}).height();b.container.css({height:h,overflow:"hidden"})}d.height=g+"px";if(i===false){d[a.fulcrumX]=a.spaceX;d[a.fulcrumY]=a.spaceY;d.position="fixed"}else{m();if(a.fulcrumX=="right"||a.fulcrumY=="bottom"){var c;e(window).resize(function(){c&&clearTimeout(c);c=setTimeout(function(){m()},0)})}d.position="absolute"}d.zIndex=a.zIndex;
if(a.opacity!==1)d.opacity=a.opacity;b.container.css(d)}function m(){var d=e(window),c=a.spaceX,f=a.spaceY;if(a.fulcrumX=="right")c=d.width()-a.spaceX-b.container.outerWidth();if(a.fulcrumY=="bottom")f=d.height()-a.spaceY-b.container.outerHeight();b.container.get(0).style.setExpression("left","eval("+c+"+(document.body.scrollLeft||document.documentElement.scrollLeft))");b.container.get(0).style.setExpression("top","eval("+f+"+(document.body.scrollTop||document.documentElement.scrollTop))")}function r(){var d;
d=s===true?{start:function(){e(this).css("position","absolute")},stop:function(){var c=n();c.position="fixed";e(this).css(c)},containment:"html",refreshPositions:true,handle:b.handle,zIndex:a.zIndex+1,cursor:"move",scroll:false}:i===true?{stop:function(){var c=e(window),f=b.container.offset();if(a.fulcrumX=="right")a.spaceX=c.width()-f.left+c.scrollLeft()-b.container.outerWidth();if(a.fulcrumY=="bottom")a.spaceY=c.height()-f.top+c.scrollTop()-b.container.outerHeight();b.container.get(0).style.setExpression("left",
"eval("+(f.left-c.scrollLeft())+"+(document.body.scrollLeft||document.documentElement.scrollLeft))");b.container.get(0).style.setExpression("top","eval("+(f.top-c.scrollTop())+"+(document.body.scrollTop||document.documentElement.scrollTop))")},handle:b.handle,zIndex:a.zIndex+1,cursor:"move",scroll:false}:{stop:function(){var c=n();c.position="fixed";e(this).css(c)},handle:b.handle,zIndex:a.zIndex+1,cursor:"move",scroll:false};b.handle.css("cursor","move");b.container.draggable(d)}function n(){var d=
e(window),c=b.container.offset(),f={};if(a.fulcrumX=="left"){f[a.fulcrumX]=c.left-d.scrollLeft();f.right="auto"}else{f[a.fulcrumX]=d.width()+d.scrollLeft()-c.left-b.container.outerWidth();f.left="auto"}if(a.fulcrumY=="top"){f[a.fulcrumY]=c.top-d.scrollTop();f.bottom="auto"}else{f[a.fulcrumY]=d.height()+d.scrollTop()-c.top-b.container.outerHeight();f.top="auto"}return f}function t(){b.button.unbind(a.action).bind(a.action,function(){u()})}function u(){if(j())k()=="open"?o():v()}function v(){if(j())if(k()!=
"open"){p();e.isFunction(a.openBeforeFunc)&&a.openBeforeFunc(b.container,b.handle,b.button);if(i===false){var d="auto",c="auto";if(a.fulcrumY=="top")d=b.container.css("top");else{c=parseInt(b.container.css("bottom"))-(g-h);b.container.css({top:b.container.offset().top-e(window).scrollTop(),bottom:"auto"})}}b.button.removeClass(a.openButtonClass+" "+a.closeButtonClass).addClass(a.openButtonClass);b.container.animate({height:g},a.speed,a.easing,function(){i===false&&b.container.css({height:g+"px",overflow:"",
top:d,bottom:c});e.isFunction(a.openAfterFunc)&&a.openAfterFunc(b.container,b.handle,b.button);l()})}}function o(){if(j()){k()=="close"&&o();p();e.isFunction(a.closeBeforeFunc)&&a.closeBeforeFunc(b.container,b.handle,b.button);if(i===false){var d="auto",c="auto";if(a.fulcrumY=="top")d=b.container.css("top");else{c=parseInt(b.container.css("bottom"))+(g-h);b.container.css({top:b.container.offset().top-e(window).scrollTop(),bottom:"auto"})}}b.button.removeClass(a.openButtonClass+" "+a.closeButtonClass).addClass(a.closeButtonClass);
b.container.css({overflow:"hidden"}).animate({height:h},a.speed,a.easing,function(){i===false&&b.container.css({top:d,bottom:c});e.isFunction(a.closeAfterFunc)&&a.closeAfterFunc(b.container,b.handle,b.button);l()})}}function j(){return b.button.hasClass("collapsebox-ready")}function l(){b.button.removeClass("collapsebox-ready").addClass("collapsebox-ready")}function p(){b.button.removeClass("collapsebox-ready")}function k(){return b.button.hasClass(a.closeButtonClass)?"close":"open"}if(a){a=e.extend({fulcrumX:"left",
spaceX:0,fulcrumY:"top",spaceY:0,zIndex:9999,opacity:1,handle:null,button:null,action:"click",speed:300,easing:"swing",openButtonClass:"collapsebox-open",closeButtonClass:"collapsebox-close",openBeforeFunc:null,openAfterFunc:null,closeBeforeFunc:null,closeAfterFunc:null,draggable:false},a);if(!(a.fulcrumX!="left"&&a.fulcrumX!="right"))if(!(a.fulcrumY!="top"&&a.fulcrumY!="bottom"))if(!(typeof a.spaceX!="number"||typeof a.spaceY!="number"))if(a.button||a.handle){var b={container:this,button:a.button.nodeType?
a.button:e(a.button,this),handle:a.handle.nodeType?a.handle:e(a.handle,this),parent:e(this.parent().get(0))};if(!(!b.container.length||!b.button.length||!b.handle.length||!b.parent.length))if(b.parent.context.nodeName.toUpperCase()=="BODY"){var g=0,h=0,i=!e.support.style&&typeof document.documentElement.style.maxHeight==="undefined",s=e.support.checkOn!==undefined?!e.support.checkOn:e.browser.safari;q();a.draggable===true&&r();t();l()}}}}})(jQuery);
